const SHEET_OBS="observaciones";const SHEET_TICKETS="tickets";const DEST_EMAIL="tucorreo@tu-liceo.cl";function doPost(e){try{const data=JSON.parse(e.postData.contents);if(data.tipo==="observacion"){return saveObs(data);}if(data.tipo==="ticket"){return saveTicket(data);}return ContentService.createTextOutput(JSON.stringify({ok:false,msg:"tipo no reconocido"})).setMimeType(ContentService.MimeType.JSON).setHeader("Access-Control-Allow-Origin","*");}catch(err){return ContentService.createTextOutput(JSON.stringify({ok:false,error:err.message})).setMimeType(ContentService.MimeType.JSON).setHeader("Access-Control-Allow-Origin","*");}}function saveObs(data){const ss=SpreadsheetApp.getActiveSpreadsheet();const sh=ss.getSheetByName(SHEET_OBS);sh.appendRow([new Date(),data.fecha||"",data.mag||"",data.comentario||"",data.user||"",data.origen||"3i-atlas"]);if(DEST_EMAIL){GmailApp.sendEmail(DEST_EMAIL,"üõ∞Ô∏è Nuevo registro 3I/ATLAS","Nueva observaci√≥n:\n"+JSON.stringify(data,null,2));}return ContentService.createTextOutput(JSON.stringify({ok:true})).setMimeType(ContentService.MimeType.JSON).setHeader("Access-Control-Allow-Origin","*");}function saveTicket(data){const ss=SpreadsheetApp.getActiveSpreadsheet();const sh=ss.getSheetByName(SHEET_TICKETS);sh.appendRow([new Date(),data.q1||"",data.q2||"",data.q3||"",data.user||"",data.origen||"3i-atlas"]);if(DEST_EMAIL){GmailApp.sendEmail(DEST_EMAIL,"üéüÔ∏è Ticket 3I/ATLAS","Nuevo ticket:\n"+JSON.stringify(data,null,2));}return ContentService.createTextOutput(JSON.stringify({ok:true})).setMimeType(ContentService.MimeType.JSON).setHeader("Access-Control-Allow-Origin","*");}